<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cc.mrbird.febs.hope.dao.DownloadInstanceMapper">

    <resultMap type="cc.mrbird.febs.hope.domain.DownloadInstance" id="DownloadInstanceMap">
        <id property="pkInstanceId" column="pk_instance_id" jdbcType="VARCHAR"/>
        <result property="downloadId" column="download_id" jdbcType="INTEGER"/>
        <result property="videoFile" column="video_file" jdbcType="VARCHAR"/>
        <result property="videoName" column="video_name" jdbcType="VARCHAR"/>
        <result property="videoType" column="video_type" jdbcType="VARCHAR"/>
        <result property="videoPath" column="video_path" jdbcType="VARCHAR"/>
        <result property="cleanFlag" column="clean_flag" jdbcType="INTEGER"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="modifyTime" column="modify_time" jdbcType="TIMESTAMP"/>
        <result property="videoSize" column="video_size" jdbcType="VARCHAR"/>
        <result property="fileCreateTime" column="file_create_time" jdbcType="TIMESTAMP"/>
        <result property="uploadInstanceId" column="upload_instance_id" jdbcType="VARCHAR"/>
        <result property="translationTitle" column="translation_title" jdbcType="VARCHAR"/>
    </resultMap>

    <!--查询主数据列表-->
    <select id="queryList" resultType="downloadInstance" parameterType="downloadInstance">
        select
        di.pk_instance_id,
        di.download_id,
        di.video_file,
        di.video_name,
        di.video_type,
        di.video_path,
        di.clean_flag,
        di.create_time,
        di.modify_time,
        ROUND(di.video_size/(1024*1024),2) as video_size,
        di.file_create_time,
        di.upload_instance_id,
        di.translation_title,
        dinfo.download_name,
        dinfo.engine_id
        from download_instance di inner join download_info dinfo on di.download_id = dinfo.download_id
        where 1=1
        <if test="downloadInstance.downloadName != null and downloadInstance.downloadName != ''">
            and dinfo.download_name like concat('%',#{downloadInstance.downloadName},'%')
        </if>
        <if test="downloadInstance.videoPath != null and downloadInstance.videoPath != ''">
            and di.video_path  like concat('%', #{downloadInstance.videoPath}, '%')
        </if>
        <if test="downloadInstance.cleanFlag != null and downloadInstance.cleanFlag != ''">
            and di.clean_flag = #{downloadInstance.cleanFlag}
        </if>
    </select>
    
</mapper>

